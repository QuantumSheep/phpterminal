setTimeout(e => {
    setTimeout(e => {
        document.getElementById("terminal-input-test").innerHTML = document.getElementById("terminal-input-test").innerHTML + "h";
    }, 100);
    setTimeout(e => {
        document.getElementById("terminal-input-test").innerHTML = document.getElementById("terminal-input-test").innerHTML + "e";
    }, 300);
    setTimeout(e => {
        document.getElementById("terminal-input-test").innerHTML = document.getElementById("terminal-input-test").innerHTML + "l";
    }, 500);
    setTimeout(e => {
        document.getElementById("terminal-input-test").innerHTML = document.getElementById("terminal-input-test").innerHTML + "p";
    }, 700);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>help [-dms] [pattern ...]</div>";
    }, 800);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>history [-c] [-d offset] [n] or history -anrw [filename] or history -p arg [arg...]</div>";
    }, 850);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + '<div id="ID01">user@user:~ $ </div>';
    }, 900);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'h';
    }, 2000);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'e';
    }, 2100);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'l';
    }, 2300);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'p';
    }, 2400);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + ' ';
    }, 2500);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'h';
    }, 2600);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'i';
    }, 2700);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 's';
    }, 2800);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 't';
    }, 2900);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'o';
    }, 3000);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'r';
    }, 3100);
    setTimeout(e => {
        document.getElementById("ID01").innerHTML = document.getElementById("ID01").innerHTML + 'y';
    }, 3200);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>history: history [-c] [-d offset] [n] or history -anrw [filename] or history -p arg [arg...]</div>";
    }, 3250);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>Display or manipulate the history list.</div>";
    }, 3300);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>Display the history list with line numbers, prefixing each modified entry with a `*'. An argument of N lists only the last N entries.</div>";
    }, 3350);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>Options:</div>";
    }, 3400);
    setTimeout(e => {
        document.getElementById("terminal-container-test").scrollTo(0, document.getElementById("terminal-container-test").scrollHeight);
    }, 3401);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-c clear the history list by deleting all of the entries</div>";
    }, 3450);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-d offset delete the history entry at position OFFSET.</div>";
    }, 3500);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-a append history lines from this session to the history file</div>";
    }, 3550);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-n read all history lines not already read from the history file and append them to the history list</div>";
    }, 3600);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-r read the history file and append the contents to the history list</div>";
    }, 3650);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-w write the current history to the history file</div>";
    }, 3700);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-p perform history expansion on each ARG and display the result without storing it in the history list</div>";
    }, 3750);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>-s append the ARGs to the history list as a single entry</div>";
    }, 3800);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>Arguments:</div>";
    }, 3850);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>PATTERN If FILENAME is given, it is used as the history file. Otherwise, if HISTFILE has a value, that is used, else ~/.bash_history. If the HISTTIMEFORMAT variable is set and not null, its value is used as a format string for strftime(3) to print the time stamp associated with each displayed history entry. No time stamps are printed otherwise.</div>";
    }, 3900);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>Exit Status:</div>";
    }, 3950);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>Returns success unless an invalid option is given or an error occurs.</div>";
    }, 4000);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + '<div id="ID02">user@user:~ $ </div>';
    }, 4050);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + 'h';
    }, 5150);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + 'i';
    }, 5250);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + 's';
    }, 5350);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + 't';
    }, 5450);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + 'o';
    }, 5550);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + 'r';
    }, 5650);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + 'y';
    }, 5750);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + "<div>1 help</div>";
    }, 5800);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + '<div>1 help</div>';
    }, 5850);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + '<div>2 help history</div>';
    }, 5900);
    setTimeout(e => {
        document.getElementById("ID02").innerHTML = document.getElementById("ID02").innerHTML + '<div>2 history</div>';
    }, 5950);
    setTimeout(e => {
        document.getElementById("terminal-content-user-test").innerHTML = document.getElementById("terminal-content-user-test").innerHTML + '<div id="ID03">user@user:~ $ </div>';
    }, 6000);
    setTimeout(e => {
        document.getElementById("terminal-container-test").scrollTo(0, document.getElementById("terminal-container-test").scrollHeight);
    }, 6001);
    setTimeout(e => {
        document.getElementById("ID03").innerHTML = document.getElementById("ID03").innerHTML + 'c';
        document.getElementById("terminal-container-test").scrollTo(0, document.getElementById("terminal-container-test").scrollHeight);
    }, 6401);
    setTimeout(e => {
        document.getElementById("ID03").innerHTML = document.getElementById("ID03").innerHTML + 'l';
    }, 6450);
    setTimeout(e => {
        document.getElementById("ID03").innerHTML = document.getElementById("ID03").innerHTML + 'e';
    }, 6500);
    setTimeout(e => {
        document.getElementById("ID03").innerHTML = document.getElementById("ID03").innerHTML + 'a';
    }, 6550);
    setTimeout(e => {
        document.getElementById("ID03").innerHTML = document.getElementById("ID03").innerHTML + 'r';
    }, 6600);
    setTimeout(e => {
        document.getElementById("terminal-container-test").removeChild(document.getElementById("term"));
    }, 6700);
    setTimeout(e => {
        document.getElementById("terminal-container-test").innerHTML = document.getElementById("terminal-container-test").innerHTML + '<div id="term"><center><p>BIENVENU SUR ALPH TERMINAL</p><p>Vous pouvez vous servir de ce terminal comme terminal de test.</p></center></div>';
    }, 6700);
    setTimeout(e => {
        document.getElementById("terminal-container-test").removeChild(document.getElementById("term"));
    }, 9700);
    setTimeout(e => {
        document.getElementById("terminal-container-test").innerHTML = document.getElementById("terminal-container-test").innerHTML +
            '<div class="terminal container" id="terminal-container">' +
            '<div class="terminal-content" id="terminal-content-user">' +
            '</div>' +
            '<div id="terminal-content-response">' +
            '<div id="terminal-user">user@user:~ $' +
            '<span class="terminal-input" id="terminal-input" contenteditable="true" spellcheck="false"></span>' +
            '<span class="terminal-caret">█</span>' +
            '</div>' +
            '</div>' +
            '</div>';
    }, 10000);
}, 1200);

const conn = new WebSocket(`ws://${window.location.hostname}${location.port ? ':' + location.port : ''}`);
let HistoryCmd = [""];
let HistoryCount = 0;
let HistoryCounter = 0;
let ClickCount = 0;

setTimeout(e => {
    const termContainer = document.getElementById("terminal-container");
conn.onopen = (e) => {
    console.log("Connection established!");

    document.getElementById('terminal-input').addEventListener('keydown', (e) => {
        if (e.key == "Enter") {
            e.preventDefault();
            if (e.target.innerHTML && e.target.innerHTML.length > 0 && e.target.innerHTML.replace(/[ ]+/i, '').length > 0) {
                e.target.innerHTML = e.target.innerHTML.replace(/^(\s+)?(.*?)(\s+)?$/, "$2");
                if (e.target.innerHTML != HistoryCmd[HistoryCounter - 1]) {
                    HistoryCmd[HistoryCounter] = e.target.innerHTML;a
                    HistoryCounter++;
                    HistoryCount++;
                }
                conn.send(e.target.innerHTML);
                appendTerminal(`user@user:~ $ ${e.target.innerHTML}`);
                e.target.innerHTML = "";
            }
        }
    });
};

document.getElementById('terminal-input').addEventListener('keydown', (e) => {
    if (e.key == "ArrowUp") {
        document.getElementById('terminal-input').addEventListener('keydown', (e) => {
            if (e.key == "Enter") {
                HistoryCount = HistoryCmd.length;
            }
        });
        HistoryCount--;
        if (HistoryCount < 1) {
            HistoryCount = 0;
        }
        document.getElementById('terminal-input').innerHTML = `${HistoryCmd[HistoryCount]}`;
    } else if (e.key == "ArrowDown") {
        document.getElementById('terminal-input').addEventListener('keydown', (e) => {
            if (e.key == "Enter") {
                HistoryCount = HistoryCmd.length;
            }
        });
        HistoryCount++;
        if (HistoryCount > HistoryCmd.length - 1) {
            HistoryCount = HistoryCmd.length;
            document.getElementById('terminal-input').innerHTML = "";
        } else {
            document.getElementById('terminal-input').innerHTML = `${HistoryCmd[HistoryCount]}`;
        }
    } else if (e.key == "Escape") {
        document.getElementById('terminal-input').innerHTML = "";
    }
});

function move() {
    console.log("Move");
};

function click(e) {
    ClickCount++;
    if (ClickCount == 1) {
        singleClickTimer = setTimeout((f) => {
            const input = document.getElementById('terminal-input');

            let range;
            let selection;

            if (document.createRange) //Firefox, Chrome, Opera, Safari, IE 9+
            {
                range = document.createRange();
                range.selectNodeContents(input);
                range.collapse(false);
                selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
            else if (document.selection) //IE 8 and lower
            {
                range = document.body.createTextRange();
                range.moveToElementText(input);
                range.collapse(false);
                range.select();
            }
            ClickCount = 0;
        }, 200);
    } else if (ClickCount > 1) {
        clearTimeout(singleClickTimer);
        ClickCount = 0;
    }
};

termContainer.addEventListener("click", click, false);

termContainer.addEventListener("mousedown", e => {
    termContainer.addEventListener("click", click, false);
    mouseDown = setTimeout((f) => {
        termContainer.addEventListener("mousemove", move, false);
        termContainer.removeEventListener("click", click, false);

    }, 200);
    termContainer.addEventListener("mouseup", e => {
        clearTimeout(mouseDown);
        termContainer.removeEventListener("mousemove", move, false);
    });
});

conn.onmessage = (e) => {
    appendTerminal(e.data);
    termContainer.scrollTo(0, termContainer.scrollHeight);
};

function appendTerminal(text) {
    document.getElementById("terminal-content-user").innerHTML = `${document.getElementById("terminal-content-user").innerHTML}<div>${text}</div>`;
}
}, 20000);